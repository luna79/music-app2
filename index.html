<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Music App UI</title>
  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel CDN para compilar JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons CDN (versión base) -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: #0c0a09; /* Tailwind: bg-neutral-950 */
    }
  </style>
</head>
<body class="bg-neutral-950">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const Icon = ({ name, size = 24, className = '', fill = 'none', strokeWidth = 2, ...props }) => {
      const [iconHtml, setIconHtml] = useState(null);

      useEffect(() => {
        if (window.lucide && window.lucide.icons[name]) {
          const icon = window.lucide.icons[name];
          const attrs = {
            width: size,
            height: size,
            class: className,
            stroke: 'currentColor',
            'stroke-width': strokeWidth,
            fill,
            'stroke-linecap': 'round',
            'stroke-linejoin': 'round',
            ...props
          };
          const svgString = window.lucide.createLucideIcon(name, icon.contents)(attrs).toSvg();
          setIconHtml(svgString);
        } else {
          console.warn(`Icono "${name}" no encontrado en la librería Lucide.`);
        }
      }, [name, size, className, fill, strokeWidth, props]);

      if (!iconHtml) return null;

      return <div className="inline-block" dangerouslySetInnerHTML={{ __html: iconHtml }} />;
    };

    // =================================================================
    // Componentes de la aplicación
    // =================================================================

    const FollowButton = ({ isFollowing, onToggleFollow }) => {
      return (
        <button
          onClick={onToggleFollow}
          className={`px-4 py-2 flex items-center gap-2 rounded-full font-semibold transition-colors duration-200 ${
            isFollowing
              ? 'bg-neutral-800 text-white'
              : 'bg-indigo-600 text-white hover:bg-indigo-700'
          }`}
        >
          {isFollowing ? (
            <>
              <Icon name="heart" size={16} fill="white" strokeWidth={1.5} />
              <span>Following</span>
            </>
          ) : (
            <>
              <Icon name="user-plus" size={16} strokeWidth={1.5} />
              <span>Follow</span>
            </>
          )}
        </button>
      );
    };

    const TrackItem = ({ track, onPlay, isPlaying, isActive }) => {
      return (
        <div
          className={`flex items-center gap-4 p-3 rounded-lg cursor-pointer transition-colors duration-200 ${
            isActive ? 'bg-neutral-700' : 'hover:bg-neutral-800'
          }`}
          onClick={() => onPlay(track.id)}
        >
          <div className="relative w-12 h-12 flex-shrink-0 rounded-lg overflow-hidden">
            <img
              src={track.albumArtUrl}
              alt={track.title}
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-200">
              {isPlaying ? (
                <Icon name="pause" size={24} className="text-white" />
              ) : (
                <Icon name="play" size={24} className="text-white" />
              )}
            </div>
          </div>
          <div className="flex-1 min-w-0">
            <p className={`text-sm font-semibold truncate ${isActive ? 'text-white' : 'text-neutral-200'}`}>
              {track.title}
            </p>
            <p className={`text-xs truncate ${isActive ? 'text-neutral-400' : 'text-neutral-500'}`}>
              {track.artist}
            </p>
          </div>
          <div className="flex items-center gap-4 text-neutral-400">
            <Icon name="heart" size={16} className="hover:text-red-500 transition-colors duration-200" />
            <Icon name="more-horizontal" size={16} />
          </div>
        </div>
      );
    };

    const TrackList = ({ tracks, onPlay, currentTrackId, isPlaying }) => {
      return (
        <div className="flex-1 space-y-2 p-6 md:p-8">
          <h2 className="text-xl md:text-2xl font-bold text-white mb-4">Lo-fi beats</h2>
          <div className="flex flex-col gap-2">
            {tracks.map((track) => (
              <TrackItem
                key={track.id}
                track={track}
                onPlay={onPlay}
                isPlaying={isPlaying && currentTrackId === track.id}
                isActive={currentTrackId === track.id}
              />
            ))}
          </div>
        </div>
      );
    };

    const Player = ({ currentTrack, isPlaying, onTogglePlay, onNext, onPrev }) => {
      return (
        <div className="sticky bottom-0 left-0 right-0 bg-neutral-900 border-t border-neutral-700 p-4 flex flex-col md:flex-row items-center justify-between gap-4">
          <div className="flex-1 flex items-center gap-4 w-full md:w-auto min-w-0">
            <img
              src={currentTrack.albumArtUrl}
              alt={currentTrack.title}
              className="w-14 h-14 rounded-lg flex-shrink-0"
            />
            <div className="flex-1 min-w-0">
              <p className="text-sm font-semibold text-white truncate">{currentTrack.title}</p>
              <p className="text-xs text-neutral-400 truncate">{currentTrack.artist}</p>
            </div>
          </div>

          <div className="flex items-center gap-6">
            <button onClick={onPrev} className="text-neutral-400 hover:text-white transition-colors duration-200">
              <Icon name="rewind" size={20} />
            </button>
            <button
              onClick={onTogglePlay}
              className="bg-white text-neutral-900 rounded-full w-12 h-12 flex items-center justify-center hover:bg-neutral-200 transition-colors duration-200"
            >
              {isPlaying ? <Icon name="pause" size={24} /> : <Icon name="play" size={24} />}
            </button>
            <button onClick={onNext} className="text-neutral-400 hover:text-white transition-colors duration-200">
              <Icon name="fast-forward" size={20} />
            </button>
          </div>

          <div className="flex-1 w-full md:w-auto h-1 bg-neutral-700 rounded-full relative">
            <div className="bg-indigo-600 absolute left-0 top-0 h-full rounded-full" style={{ width: '40%' }}></div>
          </div>
        </div>
      );
    };

    // =================================================================
    // Se ha reemplazado la función simulada por una real de iTunes
    // =================================================================

    const fetchTracks = async () => {
      // URL de la API de iTunes para buscar canciones de lo-fi
      const url = 'https://itunes.apple.com/search?term=lo-fi+beats&entity=song&limit=20';

      try {
        const response = await fetch(url);
        // Manejar errores de la red o la respuesta
        if (!response.ok) {
          throw new Error(`Error de red: ${response.statusText}`);
        }
        const data = await response.json();
        
        // Mapear los datos de la API para que coincidan con la estructura de tu app
        const formattedTracks = data.results.map(track => ({
          id: track.trackId,
          title: track.trackName,
          artist: track.artistName,
          albumArtUrl: track.artworkUrl100, // URL de la carátula del álbum
        }));
        
        // Devolver la lista de canciones ya formateada
        return formattedTracks;
      } catch (error) {
        console.error("No se pudieron cargar las canciones de la API de iTunes.", error);
        return []; // Devolver un array vacío en caso de error
      }
    };

    // =================================================================
    // Componente principal
    // =================================================================

    const App = () => {
      const [tracks, setTracks] = useState([]);
      const [currentTrackId, setCurrentTrackId] = useState(null);
      const [isPlaying, setIsPlaying] = useState(false);
      const [isFollowing, setIsFollowing] = useState(false);
      const [isLoading, setIsLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        setIsLoading(true);
        fetchTracks()
          .then(data => {
            if (data.length > 0) {
              setTracks(data);
              setCurrentTrackId(data[0].id);
              setIsLoading(false);
            } else {
              setError('No se encontraron canciones. Inténtalo con otro término de búsqueda.');
              setIsLoading(false);
            }
          })
          .catch(err => {
            setError('No se pudieron cargar las canciones. Inténtalo de nuevo más tarde.');
            setIsLoading(false);
            console.error(err);
          });
      }, []);

      const currentTrack = tracks.find(track => track.id === currentTrackId);
      const currentTrackIndex = tracks.findIndex(track => track.id === currentTrackId);

      const handlePlay = (id) => {
        if (currentTrackId === id) {
          setIsPlaying(!isPlaying);
        } else {
          setCurrentTrackId(id);
          setIsPlaying(true);
        }
      };

      const handleNext = () => {
        if (tracks.length === 0) return;
        const nextIndex = (currentTrackIndex + 1) % tracks.length;
        setCurrentTrackId(tracks[nextIndex].id);
        setIsPlaying(true);
      };

      const handlePrev = () => {
        if (tracks.length === 0) return;
        const prevIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
        setCurrentTrackId(tracks[prevIndex].id);
        setIsPlaying(true);
      };

      const handleToggleFollow = () => {
        setIsFollowing(!isFollowing);
      };

      if (isLoading) {
        return (
          <div className="min-h-screen bg-neutral-950 text-white flex items-center justify-center p-4">
            <p className="text-xl font-semibold">Cargando canciones...</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="min-h-screen bg-neutral-950 text-red-400 flex items-center justify-center p-4">
            <p className="text-xl font-semibold">{error}</p>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-neutral-950 text-white flex flex-col items-center p-4">
          <header className="w-full max-w-2xl flex items-center justify-between mb-8 md:mb-12">
            <div className="flex items-center gap-4">
              <img
                src="https://placehold.co/64x64/1f2937/d1d5db?text=User"
                alt="User Profile"
                className="w-16 h-16 rounded-full"
              />
              <div>
                <h1 className="text-2xl font-bold">Lofi Radio</h1>
                <p className="text-sm text-neutral-400">@lofi-beats</p>
              </div>
            </div>
            <FollowButton isFollowing={isFollowing} onToggleFollow={handleToggleFollow} />
          </header>
          <main className="w-full max-w-2xl bg-neutral-900 rounded-2xl shadow-xl overflow-hidden mb-6">
            {currentTrack && (
              <TrackList
                tracks={tracks}
                onPlay={handlePlay}
                currentTrackId={currentTrackId}
                isPlaying={isPlaying}
              />
            )}
          </main>
          {currentTrack && (
            <Player
              currentTrack={currentTrack}
              isPlaying={isPlaying}
              onTogglePlay={() => handlePlay(currentTrackId)}
              onNext={handleNext}
              onPrev={handlePrev}
            />
          )}
        </div>
      );
    };

    // Montar la aplicación en el DOM
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>